#!/usr/bin/env node

var logger = new (require("../lib/logger")).Logger();
var wpilgen = require("../lib/wpilgenerator");
var pargv = process.argv;
var penv = process.env;
var checkPassed = true;
var doCheck = function (condition, message) {
  if (!checkPassed) {
    return !checkPassed;
  }
  if (condition) {
    logger.log(message);
    checkPassed = !condition;
    return;
  }
  checkPassed = condition;
}
if (pargv.length === 2) {
  doCheck((penv.TRAVIS_SECURE_ENV_VARS !== "true") || (penv.GH_TOKEN === ""), "Secure environment variable is not set");
  doCheck(penv.TRAVIS_OS_NAME !== "linux", `Running on '${penv.TRAVIS_OS_NAME}' is not allowed`);
  doCheck(penv.TRAVIS_NODE_VERSION !== "7.9.0", `Running on node version '${penv.TRAVIS_NODE_VERSION}' is not allowed`);
  doCheck(penv.TRAVIS_PULL_REQUEST !== "false", "Running on Pull Request is not allowed");
  doCheck(penv.TRAVIS_BRANCH !== "master", `Running on branch '${penv.TRAVIS_BRANCH}' is not allowed`);
  doCheck(penv.TRAVIS_REPO_SLUG !== "vscode-icons/vscode-icons", `Running on '${penv.TRAVIS_REPO_SLUG}' is not allowed`);
  if (!checkPassed) { return; }
  pargv.push("all", "-o", "repo", "-t", penv.GH_TOKEN);
}
wpilgen.main();
